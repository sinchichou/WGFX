// 由 WGFX 組裝器生成 - 獨特註解: 1764780507447 - Pass 1

// --- 通用程式碼 ---
alias uint2 = vec2<u32>;
alias uint3 = vec3<u32>;
alias int2 = vec2<i32>;
alias MF = f32;
alias MF2 = vec2<f32>;
alias MF3 = vec3<f32>;
alias MF4 = vec4<f32>;
alias MF2x2 = mat2x2<f32>;
alias MF3x3 = mat3x3<f32>;
alias MF4x4 = mat4x4<f32>;
alias MF2x3 = mat3x2<f32>;
alias MF2x4 = mat4x2<f32>;
alias MF3x2 = mat2x3<f32>;
alias MF3x4 = mat4x3<f32>;
alias MF4x2 = mat2x4<f32>;
alias MF4x3 = mat3x4<f32>;

fn GetInputSize() -> uint2 {
    return uint2(0, 0);
}

fn GetInputPt() -> MF2 {
    return MF2(0, 0);
}

fn Rmp8x8(idx: u32) -> uint2 {
    return uint2(idx / 8u, idx % 8u);
}

@group(0) @binding(0) var sam: sampler;

@group(0) @binding(1) var INPUT: texture_2d<f32>;
@group(0) @binding(2) var tex1_sampled: texture_2d<f32>;
@group(0) @binding(3) var tex1_storaged: texture_storage_2d<rgba16float, write>;
@group(0) @binding(4) var tex2_sampled: texture_2d<f32>;
@group(0) @binding(5) var tex2_storaged: texture_storage_2d<rgba16float, write>;
@group(0) @binding(6) var tex3_sampled: texture_2d<f32>;
@group(0) @binding(7) var tex3_storaged: texture_storage_2d<rgba16float, write>;

// --- 通道 1 ---
@compute @workgroup_size(64, 1, 1) 
fn main_cs (@builtin(workgroup_id) workgroup_id: uint3, @builtin(local_invocation_id) local_id: uint3) {
    let gxy = (Rmp8x8(local_id.x) * 2u) + workgroup_id.xy;
    let inputSize = GetInputSize();
    if (gxy.x >= inputSize.x || gxy.y >= inputSize.y) {
        return;
    }

    let inputPt = GetInputPt();

    var src: array<array<MF3, 4>, 4>;
    for (var i: u32 = 0u; i <= 2u; i += 2u) {
        for (var j: u32 = 0u; j <= 2u; j += 2u) {
            let tpos = (MF2(gxy) + MF2(f32(i), f32(j))) * inputPt;
            let sr: MF4 = textureGather(0, INPUT, sam, tpos);
            let sg: MF4 = textureGather(1, INPUT, sam, tpos);
            let sb: MF4 = textureGather(2, INPUT, sam, tpos);

            // w z -> x z
		    // x y   y w
            src[i][j] = MF3(sr.x, sg.x, sb.x);
            src[i][j + 1u] = MF3(sr.y, sg.y, sb.y);
            src[i + 1u][j] = MF3(sr.z, sg.z, sb.z);
            src[i + 1u][j + 1u] = MF3(sr.w, sg.w, sb.w);
        }
    }

    for (var i: u32 = 1u; i <= 2u; i += 1u) {
        for (var j: u32 = 1u; j <= 2u; j += 1u) {
            let destPos: uint2 = gxy + uint2(i - 1u, j - 1u);

            if (i != 1u || j != 1u) {
                if (destPos.x >= inputSize.x || destPos.y >= inputSize.y) {
                    continue;
                }
            }

            var target1: MF4 = MF4(-0.03509807, 0.029998481, -0.08691994, -0.017055636);
			target1 = (src[i - 1][j - 1] * MF3x4(-0.23234928, -0.070085905, 0.0040122913, 0.21575761, -0.25936925, -0.20185155, 0.022299573, 0.2812235, -0.11045535, -0.11106335, -0.12113332, -0.49919847) + target1);
			target1 = (src[i - 1][j] * MF3x4(-0.48585954, -0.058959674, 0.11114158, -0.1971666, -0.24872562, 0.2667282, -0.107163996, 0.12475151, -0.027792914, -0.06700173, -0.10966316, 0.09399147) + target1);
			target1 = (src[i - 1][j + 1] * MF3x4(-0.16666615, -0.15644506, 0.048309084, 0.19122206, -0.1522582, 0.15417537, -0.23017146, 0.09460856, 0.074704535, 0.2168164, 0.2077189, -0.29264635) + target1);
			target1 = (src[i][j - 1] * MF3x4(0.3167284, -0.20522436, -0.050071932, -0.036290437, 0.20206359, 0.012589764, -0.1251284, -0.2911492, -0.0006390347, -0.09853893, 0.14406726, 0.33612582) + target1);
			target1 = (src[i][j] * MF3x4(0.13786903, 0.51342535, -0.44004235, -0.23918492, 0.5614157, 0.011565876, 0.5419984, -0.15937872, -0.075360805, 0.018496322, 0.12582661, 0.40117717) + target1);
			target1 = (src[i][j + 1] * MF3x4(0.19644158, 0.12697817, 0.15092115, 0.1963961, -0.03395398, -0.17465135, -0.04086773, 0.09187623, 0.18238129, -0.0063141263, -0.26402372, -0.28761682) + target1);
			target1 = (src[i + 1][j - 1] * MF3x4(-0.010849395, 0.15082607, 0.095264904, -0.038952388, -0.1121466, 0.21590506, 0.029462064, -0.65400773, 0.18295552, 0.2425088, 0.121624336, 0.7189011) + target1);
			target1 = (src[i + 1][j] * MF3x4(0.17197245, -0.04397748, 0.18232836, -0.04471754, 0.071163684, -0.20590816, 0.39706057, -0.5452873, -0.11754515, 0.006909551, 0.018450081, 0.5686299) + target1);
			target1 = (src[i + 1][j + 1] * MF3x4(0.077441245, -0.25645187, -0.19979256, -0.010363122, -0.04312338, -0.08810754, -0.059999906, 0.38630447, -0.11017497, -0.16309647, 0.026156282, -0.35432625) + target1);

			var target2: MF4 = MF4(0.6537504, 0.07195351, -0.38729003, -0.0374416 );
			target2 = (src[i - 1][j - 1] * MF3x4(-0.34123975, 0.06927292, 0.12252625, 0.1038146, 0.15979475, 0.24436772, -0.016088272, -0.22664197, 0.16932374, 0.10719134, -0.16895153, 0.100098394) + target2);
			target2 = (src[i - 1][j] * MF3x4(0.11094869, -0.1379463, -0.53625333, -0.42690855, 0.12101115, -0.004709155, 0.6293494, 0.4763549, 0.030926082, -0.20099613, 0.39174548, 0.31219363) + target2);
			target2 = (src[i - 1][j + 1] * MF3x4(0.08731028, -0.010540878, 0.0757335, -0.1466203, -0.23115048, -0.17813745, 0.17698573, 0.18787299, 0.16219892, 0.10475756, -0.23984352, 0.025724094) + target2);
			target2 = (src[i][j - 1] * MF3x4(0.27665043, 0.4118298, -0.08762915, -0.07885308, 0.05053698, 0.28148478, -0.005842398, 0.15139125, -0.3791668, 0.24871133, 0.18160823, -0.10384939) + target2);
			target2 = (src[i][j] * MF3x4(-0.3206045, -0.22038852, -0.3038138, -0.0482595, -0.26852164, -0.23278148, 0.30639926, 0.2578657, -0.3874695, 0.06441954, 0.00026220892, 0.04361178) + target2);
			target2 = (src[i][j + 1] * MF3x4(-0.17908047, -0.0900835, 0.00652168, -0.038639892, 0.1520494, -0.13204975, -0.020355739, 0.26766944, 0.021308672, -0.31918222, 0.050667368, 0.10367864) + target2);
			target2 = (src[i + 1][j - 1] * MF3x4(-0.112388864, 0.053321466, 0.2691917, 0.26902813, 0.010105532, 0.24898581, -0.13757521, -0.10214595, 0.23615286, -0.09560994, -0.15046176, -0.08853913) + target2);
			target2 = (src[i + 1][j] * MF3x4(-0.36796987, -0.2124952, -0.07535088, 0.13065732, -0.21852261, 0.06934692, -0.013749303, -0.44900006, 0.3352218, 0.090437174, 0.08993535, -0.3050165) + target2);
			target2 = (src[i + 1][j + 1] * MF3x4(0.11873657, 0.13483031, 0.22352207, 0.23666611, 0.18977334, -0.32066482, -0.31396368, -0.5615055, -0.14588253, 0.0121516865, 0.0614425, -0.079611346) + target2);

			var target3: MF4 = MF4(0.04453386, 0.06632044, 0.061607827, -0.19856223 );
            target3 = (src[i - 1][j - 1] * MF3x4(0.16112354, 0.3756035, 0.09619928, 0.17283864, 0.054338567, -0.061197184, -0.10173672, -0.032733057, -0.111913994, -0.28940153, -0.062114924, 0.20520677) + target3);
			target3 = (src[i - 1][j] * MF3x4(0.3500745, 0.467141, -0.101748556, 0.43384346, 0.06712478, -0.43235737, 0.014446082, -0.12634972, -0.07507498, 0.025314584, 0.22664048, 0.22121347) + target3);
			target3 = (src[i - 1][j + 1] * MF3x4(-0.089320965, 0.319314, -0.06869195, -0.2465581, 0.449762, -0.38919032, 0.1562217, 0.05368933, 0.20758076, 0.0659555, -0.109858744, -0.114917934) + target3);
			target3 = (src[i][j - 1] * MF3x4(-0.07451217, 0.2239877, -0.009071173, 0.21869898, 0.042301223, 0.13635477, -0.20052543, 0.26130545, -0.051627826, -0.3429969, 0.093028575, -0.35710186) + target3);
			target3 = (src[i][j] * MF3x4(-0.16129561, -0.31247056, -0.123016216, 0.2122524, -0.2972285, 0.2718142, -0.17284301, 0.44368207, -0.032497104, 0.18240568, -0.28283152, -0.10045272) + target3);
			target3 = (src[i][j + 1] * MF3x4(0.15945031, -0.6797371, 0.3974546, 0.24741851, -0.1340806, 0.41666976, 0.27850744, -0.21406768, 0.096567124, 0.23366652, 0.15648519, -0.07626781) + target3);
			target3 = (src[i + 1][j - 1] * MF3x4(-0.053246673, 0.14282355, -0.114118166, -0.3172004, -0.18055372, -0.3400759, -0.19622837, 0.076828666, 0.29225305, 0.14866155, 0.07959014, -0.041400358) + target3);
			target3 = (src[i + 1][j] * MF3x4(-0.25331625, -0.14193451, 0.04879846, -0.077393495, 0.0104558095, 0.37905747, -0.07880302, -0.09453499, -0.1426901, -0.19738746, -0.28036812, 0.03675319) + target3);
			target3 = (src[i + 1][j + 1] * MF3x4(-0.08954212, -0.47161737, -0.12388452, -0.08005436, 0.04682568, 0.048485547, 0.31411946, -0.31375095, -0.22892538, 0.16906887, 0.16802602, 0.18711087) + target3);

			textureStore(tex1_storaged, destPos, target1);
			textureStore(tex2_storaged, destPos, target2);
			textureStore(tex3_storaged, destPos, target3);
		}
	}
}